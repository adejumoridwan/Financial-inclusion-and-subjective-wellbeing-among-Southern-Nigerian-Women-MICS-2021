---
title: "Financial Inclusion and Subjective Well Being"
format: html
---

# Libraries
```{r}
# Install pacman if it's not already installed
if (!require("pacman")) {
  install.packages("pacman", dependencies = TRUE)
  library(pacman)
}

# Use pacman to load or install the required packages
pacman::p_load(tidyverse, haven, lavaan, srvyr, lavaanPlot)


```

# Load Data
```{r}
# Load the women data
wm <- read_sav("wm.sav") |> 
  # filter only women in southern region
  filter(zone %in% c(4,5,6))

```

# CFA
```{r}
#confirmatory factor analysis
model <- '
  #measurement model
    awareness =~ FN1A + FN1B + FN1C + FN1D + FN1E + FN1F + FN1G + FN1H + FN1I + FN1J + FN1K + FN1L
    usage =~ FN2 + FN4A + FN4C + FN4D + FN4E + FN4F + FN4G + FN4H + FN4X + FN4NR + FN5
    FI =~ awareness + usage
    SW =~ LS1 + LS2 + LS3 + LS4
'
# cfa model
fit <- sem(model, data = wm, cluster = "PSU",sampling.weights="wmweight")

# check for modification indices, factor loadings less than 0.5 are dropped
modindices(fit, sort = TRUE, maximum.number = 5)

#summary measures
summary(fit, standardized = TRUE, fit.measures=TRUE)
```


# SEM
```{r}
# Structural Equation Model
model <- '
  #measurement model
    awareness =~ FN1B + FN1D + FN1E + FN1G + FN1H + FN1I
    usage =~ FN2 + FN4H + welevel
    FI =~ awareness + usage + FN1A
    SW =~ LS1 + LS3
  #regressions
    FI ~ welevel
    HH6 ~ welevel + FI + zone
    SW ~ FI
  #residual correlations
    FN1H ~~ FN1I
    FN1A ~~ FN1B
    LS1 ~~ LS3
'
#sem model
fit <- sem(model, data = wm, cluster = "PSU",sampling.weights="wmweight")

# summary measures
summary(fit, standardized = TRUE, fit.measures=TRUE)


#fitMeasures(fit, c("cfi","rmsea","srmr"))

```

## SEM Plot
```{r}
# plot the SEM diagram
lavaanPlot(model = fit, node_options = list(shape = "box", fontname = "Helvetica"), edge_options = list(color = "grey"), coefs = T)

```

